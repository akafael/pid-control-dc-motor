% Pacotes e configurações padrão do estilo ``article''\
% -------------------------------------
\documentclass[a4paper,11pt]{article}
% Layout
% --------------------------------------------------------------------------------
\input{relat_layout.tex}

\title{Laboratório X} % Define o título do Relatório
\author{Rafael Lima}

% Definições Auxiliares ( Macros próprias )
% -----------------------------------------------------------------
%\input{relat_aux.tex} % Arquivo com minhas macros
% ----------------------------------~>ø<~---------------------------------------
\begin{document}
% Capa e Índice ---------------------------------------------------------------
\input{relat_capa.tex} % Capa para UnB
% Conteúdo -------------------------------------------------------------------

% Material de referência - prof
% https://drive.google.com/drive/folders/1IDdc7QVsdYIASgZzNlUelhGF_FaV2_EJ

\section{Descrição da Planta}

\subsection{Modelo Motor DC}

% Como modelar um motor ------------------------------
% http://ctms.engin.umich.edu/CTMS/index.php?example=MotorSpeed&section=SystemModeling
% http://ctms.engin.umich.edu/CTMS/index.php?example=MotorSpeed&section=SimulinkModeling
% http://www.inf.fu-berlin.de/lehre/WS04/Robotik/motors.pdf
% https://ir.nctu.edu.tw/bitstream/11536/125183/36/509-2.pdf
% http://users.isr.ist.utl.pt/~alex/micd0506/motordc.pdf
% http://homepages.laas.fr/lzaccari/seminars/DCmotors.pdf
% https://www.control.isy.liu.se/student/tsrt21/file/pm_dcmotor.pdf

% Técnica antiga de controle ------------------------
% https://en.wikipedia.org/wiki/Ward_Leonard_control

\section{Identificação de Parâmetros}

% http://www.eletrica.ufpr.br/~gustavo/controle_digital/Intro_Ident_Intro_v23abr12.pdf
% convert from ft to ss https://www.mathworks.com/help/signal/ref/tf2ss.html
% convert from ss to ft https://www.mathworks.com/help/matlab/ref/ss2tf.html

Para validar o sistema foi definido um planta para simular o comportamento de um sistema de primeira ordem e um sistema de segunda ordem para uma mesma entrada. O sinal de entrada e a resposta de saída do sistema é então armazenado em arquivo \textit{.mat} para leitura posterior.

% Modelo Figura
\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\linewidth]{tex/img/dcMotorSimulation.pdf}
    \caption{Planta Simulação}
    \label{fig:my_label}
\end{figure}

\subsection{Região não Linear - Zona Morta}

% Maior valor da entrada pelo qual a saída é zero.

\subsection{Estimação modelo como primeira ordem}

Supondo um modelo de primeira ordem com coeficientes $k_1$ e $k_2$ definido por:

\begin{equation}
    H_1(s) = \frac{Y(s)}{X(s)} = \frac{1}{k_1 s+ k_2}
\end{equation}

% Equação de Transferência

Podemos reescrever a função de transferência como
\begin{equation}
k_1 Ys + k_2 Y  = X
\end{equation}

% EDO
A partir do qual temos o sistema descrito a partir da seguinte equação diferencial:

\begin{equation}
k_1 \dot{y}(t) + k_2 y(t) = x(t)
\end{equation}

Tomando os valores de entrada e saída do sistema em diferentes instantes para um sinal de entrada temos:

% Sistema Linear
\begin{equation}
\left\{\begin{array}{c}
    k_1 \dot{y}(t_0) + k_2 y(t_0) = x(t_0)  \\
    \dots\\
    k_1 \dot{y}(t_i) + k_2 y(t_i) = x(t_i)  \\
\end{array} \right.
\end{equation}

% Representação como Matriz

Podemos representar a equação na forma matricial:

\begin{equation}
\left[\begin{array}{cc}
    \dot{y}(t_0) & y(t_0)\\
    \dots  & \dots \\
    \dot{y}(t_i) & y(t_i)\\
\end{array} \right]
\left[\begin{array}{c}
    k_1\\
    k_2\\
\end{array} \right]
=
\left[\begin{array}{c}
    x(t_0)  \\
    \dots\\
    x(t_i)  \\
\end{array} \right]
\end{equation}

% Resolução por Matrizes

Denominando $A$ a matriz envolvendo $\dot{y}(t)$ e $y(t)$, $Bt)$ a matriz dos valores de entrada $x(t)$

\begin{equation}
    A(t) P = B(t)
\end{equation}

\begin{equation}
    A^T(t)A(t) P = A^T(t) B(t)
\end{equation}

Isolando a matriz $P$ podemos achar o parâmetros a partir da seguinte expressão:

\begin{equation}
    P = \left(A^T(t) A(t)\right)^{-1} A^T(t) B(t)
\end{equation}

Para implementar em MATLAB podemos aproximar $\dot{y}(t)$ pelo método de diferenças finitas como

\begin{equation}
\dot{y}(t_i) = \dot{y}[t_i] = \frac{y[t_i] - y[t_{i-1}]}{t_i - t_{i-1}}
\end{equation}

Usando operações de matrizes o código fica bem compacta, como mostrado abaixo:

% Código
\inputminted{matlab}{../src/matlab/firstordertf.m}

\subsection{Modelo Linear 2 ordem}

Supondo um modelo de primeira ordem com coeficientes $k_1$, $k_2$ e $k_3$ definido por:

\begin{equation}
    H_2(s) = \frac{Y(s)}{X(s)} = \frac{1}{k_1 s^2+ k_2 s+ k_3}
\end{equation}

% Equação de Transferência

Podemos reescrever a função de transferência como
\begin{equation}
k_1 Ys^2 + k_2 Ys + k_3 Y  = X
\end{equation}

% EDO
A partir do qual temos o sistema descrito a partir da seguinte equação diferencial:

\begin{equation}
k_1 \ddot{y}(t) + k_2 \dot{y}(t) + k_3 y(t) = x(t)
\end{equation}

Tomando os valores de entrada e saída do sistema em diferentes instantes para um sinal de entrada temos:

% Sistema Linear
\begin{equation}
\left\{\begin{array}{c}
    k_1 \ddot{y}(t_0) + k_2 \dot{y}(t_0) + k_3 y(t_0) = x(t_0)  \\
    \dots\\
    k_1 \ddot{y}(t_i) + k_2 \dot{y}(t_i) + k_3 y(t_i) = x(t_i)  \\
\end{array} \right.
\end{equation}

% Representação como Matriz

Podemos representar a equação na forma matricial:

\begin{equation}
\left[\begin{array}{ccc}
    \ddot{y}(t_0) & \dot{y}(t_0) & y(t_0)\\
    \dots  & \dots & \dots \\
    \ddot{y}(t_i) & \dot{y}(t_i) & y(t_i)\\
\end{array} \right]
\left[\begin{array}{c}
    k_1\\
    k_2\\
    k_3\\
\end{array} \right]
=
\left[\begin{array}{c}
    x(t_0)  \\
    \dots\\
    x(t_i)  \\
\end{array} \right]
\end{equation}

% Resolução por Matrizes

De forma similar ao caso de primeira ordem, denominando $A$ a matriz envolvendo $\ddot{y}(t)$, $\dot{y}(t)$ e $y(t)$, $Bt)$ a matriz dos valores de entrada $x(t)$

\begin{equation}
    A(t) P = B(t)
\end{equation}

\begin{equation}
    A^T(t)A(t) P = A^T(t) B(t)
\end{equation}

Isolando a matriz $P$ podemos achar o parâmetros a partir da seguinte expressão:

\begin{equation}
    P = \left(A^T(t) A(t)\right)^{-1} A^T(t) B(t)
\end{equation}

Em MATLAB, usando operações de matrizes a implementação fica bem compacta, como mostrado abaixo:

% Código
\inputminted{matlab}{../src/matlab/secondordertf.m}

\subsection{Validação do Método em Simulação}

Aplicando um sinal de entrada em uma planta simulada de primeira ordem com coeficientes escolhidos de forma aleatória, obtemos a seguinte as seguintes respostas para o modelo aproximado de primeira ordem e de segunda ordem, conforme mostrado na figura \ref{fig:model1Evaluation}.

% Modelo Figura
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{tex/img/model1Evaluation.pdf}
    \caption{Comparação Modelo Primeira Ordem}
    \label{fig:model1Evaluation}
\end{figure}

Procedendo da mesma forma, aplicando um sinal de entrada em uma planta simulada de segunda ordem com coeficientes escolhidos de forma aleatória, obtemos a seguinte as seguintes respostas para o modelo aproximado de primeira ordem e de segunda ordem, conforme mostrado na figura \ref{fig:model2Evaluation}.

% Modelo Figura
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{tex/img/model2Evaluation.pdf}
    \caption{Comparação Modelo Segunda Ordem}
    \label{fig:model2Evaluation}
\end{figure}

Nota-se que em ambos casos, existe um erro entre a resposta do sistema com os parâmetros identificados e o planta original simulada. Isto se deve ao fato que o método de diferenças finitas apenas representa uma aproximação e portanto não representa derivada de forma exata.

Em uma planta real pode ser utilizado algum sensor para medir a velocidade e a aceleração ou ainda adotar alguma aproximação melhor para aproximação da derivada.

% Descrição da Planta
%% Diagrama de descrição

% ---------------------------------------------------------------------------------------

\section{Controle PID}
\subsection{Planta Simulação PID}

A partir dos dados da identificação, a resposta da planta com o controle PID implementado é simuladas utilizando o Simulink, ilustrada na figura \ref{fig:pidControlPlant}. Na simulação é comparado a resposta ao PID a partir das função de transferência de primeira e de segunda ordem geradas pela etapa de identificação.

\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\linewidth]{tex/img/dcMotorControl.pdf}
    \caption{Planta Simulação Controle PID}
    \label{fig:pidControlPlant}
\end{figure}

\section{Conclusão}

% ---------------------------------------------------------------------------------------

\bibliographystyle{abbrv}
\bibliography{references}
% Referências
% Acrescentadas no arquivo references.bib
% para usa-las no texto batsa usar \citep{}


% ---------------------------------------------------------------------------------------


\end{document}
